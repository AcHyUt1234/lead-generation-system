name: Lead Generation Pipeline

on:
  # Run manually from Actions tab
  workflow_dispatch:
  
  # Uncomment below to run on schedule (daily at 3 AM UTC)
  # schedule:
  #   - cron: '0 3 * * *'
  
  # Uncomment below to run on every push (useful for testing)
  # push:
  #   branches: [ master ]

jobs:
  generate-leads:
    runs-on: ubuntu-latest
    timeout-minutes: 60  # 1 hour max
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas requests anthropic
    
    - name: Create outputs directory
      run: mkdir -p outputs
    
    - name: Run lead generation pipeline
      env:
        ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        APOLLO_API_KEY: ${{ secrets.APOLLO_API_KEY }}
        HUBSPOT_API_KEY: ${{ secrets.HUBSPOT_API_KEY }}
      run: |
        python lead_generation_pipeline.py
    
    - name: Upload CSV results
      uses: actions/upload-artifact@v4
      if: always()  # Upload even if previous steps fail
      with:
        name: lead-export-${{ github.run_number }}
        path: outputs/*.csv
        retention-days: 90
        if-no-files-found: warn
    
    - name: Display results summary
      if: always()
      run: |
        echo "==================================================="
        echo "Pipeline Execution Complete"
        echo "==================================================="
        if [ -f outputs/*.csv ]; then
          echo "✓ CSV file(s) created successfully"
          ls -lh outputs/
        else
          echo "⚠ No CSV files found"
        fi
        echo "==================================================="
